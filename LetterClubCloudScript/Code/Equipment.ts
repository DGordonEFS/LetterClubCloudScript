
class EquipmentData {
    public static readonly LetterDataByArenaAndRarity = {
        Arena0: [
            [1],
            [1, 1],
            [2, 1]
        ],
        Arena1: [
            [1, 1],
            [2, 1],
            [2, 1, 1]
        ],
        Arena2: [
            [2, 1],
            [2, 2],
            [2, 2, 1]
        ],
        Arena3: [
            [2, 2],
            [3, 2],
            [3, 2, 1]
        ]
    };

    public static readonly HeadgearImages: HeadgearImageData = {
        Arena0: {
            Common: ["c_a0_0", "c_a0_1", "c_a0_2", "c_a0_3", "c_a0_4", "c_a0_5", "c_a0_6", "c_a0_7", "c_a0_8", "c_a0_9", "c_a0_10", "c_a0_11", "c_a0_12", "c_a0_13", "c_a0_14", "c_a0_15",
                "c_a0_16", "c_a0_17", "c_a0_18", "c_a0_19", "c_a0_20", "c_a0_21", "c_a0_22", "c_a0_23", "c_a0_24", "c_a0_25"],
            Rare: [],
            Epic: [],
            Legendary: []
        },
        Arena1: {
            Common: ["c_a1_0", "c_a1_1", "c_a1_2", "c_a1_3", "c_a1_4", "c_a1_5", "c_a1_6", "c_a1_7", "c_a1_8", "c_a1_9", "c_a1_10", "c_a1_11", "c_a1_12", "c_a1_13", "c_a1_14", "c_a1_15",
                "c_a1_16", "c_a1_17", "c_a1_18", "c_a1_19", "c_a1_20", "c_a1_21", "c_a1_22", "c_a1_23", "c_a1_24", "c_a1_25"],
            Rare: [],
            Epic: [],
            Legendary: []
        },
        Arena2: {
            Common: ["c_a2_0", "c_a2_1", "c_a2_2", "c_a2_3", "c_a2_4", "c_a2_5", "c_a2_6", "c_a2_7", "c_a2_8", "c_a2_9", "c_a2_10", "c_a2_11", "c_a2_12", "c_a2_13", "c_a2_14", "c_a2_15",
                "c_a2_16", "c_a2_17", "c_a2_18", "c_a2_19", "c_a2_20", "c_a2_21", "c_a2_22", "c_a2_23", "c_a2_24", "c_a2_25"],
            Rare: [],
            Epic: [],
            Legendary: []
        },
        Arena3: {
            Common: ["c_a3_0", "c_a3_1", "c_a3_2", "c_a3_3", "c_a3_4", "c_a3_5", "c_a3_6", "c_a3_7", "c_a3_8", "c_a3_9", "c_a3_10", "c_a3_11", "c_a3_12", "c_a3_13", "c_a3_14", "c_a3_15",
                "c_a3_16", "c_a3_17", "c_a3_18", "c_a3_19", "c_a3_20", "c_a3_21", "c_a3_22", "c_a3_23", "c_a3_24", "c_a3_25"],
            Rare: [],
            Epic: [],
            Legendary: []
        },
        Shared: {
            Common: [],
            Rare: ["r_twoHearts_0", "r_twoHearts_1", "r_twoHearts_2", "r_twoHearts_3", "r_twoHearts_4", "r_twoHearts_5", "r_twoHearts_6", "r_twoHearts_7", "r_twoHearts_8", "r_twoHearts_9",
                "r_fourEyes_0", "r_fourEyes_1", "r_fourEyes_2", "r_fourEyes_3", "r_fourEyes_4", "r_fourEyes_5", "r_fourEyes_6", "r_fourEyes_7", "r_fourEyes_8", "r_fourEyes_9",
                "r_anime_0", "r_anime_1", "r_anime_2", "r_anime_3", "r_anime_4", "r_anime_5", "r_anime_6", "r_anime_7", "r_anime_8", "r_anime_9",
                "r_cat_0", "r_cat_1", "r_cat_2", "r_cat_3", "r_cat_4", "r_cat_5", "r_cat_6", "r_cat_7", "r_cat_8", "r_cat_9",
                "r_pyramid_0", "r_pyramid_1", "r_pyramid_2", "r_pyramid_3", "r_pyramid_4", "r_pyramid_5", "r_pyramid_6", "r_pyramid_7", "r_pyramid_8", "r_pyramid_9",
                "r_round_0", "r_round_1", "r_round_2", "r_round_3", "r_round_4", "r_round_5", "r_round_6", "r_round_7", "r_round_8", "r_round_9",
                "r_shutter_0", "r_shutter_1", "r_shutter_2", "r_shutter_3", "r_shutter_4", "r_shutter_5", "r_shutter_6", "r_shutter_7", "r_shutter_8", "r_shutter_9",
                "r_star_0", "r_star_1", "r_star_2", "r_star_3", "r_star_4", "r_star_5", "r_star_6", "r_star_7", "r_star_8", "r_star_9",
                "r_visor_0", "r_visor_1", "r_visor_2", "r_visor_3", "r_visor_4", "r_visor_5", "r_visor_6", "r_visor_7", "r_visor_8", "r_visor_9",
                "r_vr_0", "r_vr_1", "r_vr_2", "r_vr_3", "r_vr_4", "r_vr_5", "r_vr_6", "r_vr_7", "r_vr_8", "r_vr_9",
                "r_wings_0", "r_wings_1", "r_wings_2", "r_wings_3", "r_wings_4", "r_wings_5", "r_wings_6", "r_wings_7", "r_wings_8", "r_wings_9"],
            Epic: ["e_bunny_0", "e_bunny_1", "e_bunny_2", "e_bunny_3", "e_bunny_4",
                "e_donut_0", "e_donut_1", "e_donut_2", "e_donut_3", "e_donut_4",
                "e_eyepatch_0", "e_eyepatch_1", "e_eyepatch_2", "e_eyepatch_3", "e_eyepatch_4",
                "e_hypno_0", "e_hypno_1", "e_hypno_2", "e_hypno_3", "e_hypno_4",
                "e_mustache_0", "e_mustache_1", "e_mustache_2", "e_mustache_3", "e_mustache_4",
                "e_scuba_0", "e_scuba_1", "e_scuba_2", "e_scuba_3", "e_scuba_4",
                "e_steampunk_0", "e_steampunk_1", "e_steampunk_2", "e_steampunk_3", "e_steampunk_4",
                "e_oldman_0", "e_oldman_1", "e_oldman_2", "e_oldman_3", "e_oldman_4"],
            Legendary: []
        }
    };

    
    private static GetRandomLetters(arenaIndex:number, rarity:number) : EquipmentLetterData {
        log.debug("getrandomletters");
        var letterData: EquipmentLetterData = {};

        var letters = [
            "a", "b", "c", "d", "e", "f", "g", "h", "i", "j", "k", "l", "m", "n", "o", "p", "q", "r", "s", "t", "u", "v",
            "w", "x", "y", "z"
        ];
        
        var getUniqueLetter = () => {
            var index = Math.floor(Math.random() * letters.length);
            var letter = letters[index];
            letters.splice(index, 1);
            return letter;
        };

        var arena = "Arena" + arenaIndex;
        log.debug(arena + ", " + rarity);

        var tier = EquipmentData.LetterDataByArenaAndRarity["Arena" + arenaIndex][rarity];
        log.debug("tier: " + tier);
        for (var i = 0; i < tier.length; i++) {
            letterData[getUniqueLetter()] = tier[i];
        }

        log.debug("created letters");
        
        return letterData;
    }
    
    public static GetRandomHeadGear(rarity: number): Equipment {
        log.debug("get random headgear");
        var userDataResult = server.GetUserData({
            PlayFabId: currentPlayerId,
            Keys: ["profile"]
        });

        var userProfile = JSON.parse(userDataResult.Data["profile"].Value);

        var arenaIndex: number = userProfile.ArenaIndex;


        var letterData = EquipmentData.GetRandomLetters(arenaIndex, rarity);
        var headgearImage: string;

        switch (rarity) {
            case Constants.Common:
                var letters = [
                    "a", "b", "c", "d", "e", "f", "g", "h", "i", "j", "k", "l", "m", "n", "o", "p", "q", "r", "s", "t", "u", "v",
                    "w", "x", "y", "z"
                ];

                var highestLetter: string;
                var highestAmount: number = 0;
                for (var letter in letterData) {
                    var amount = letterData[letter];

                    if (amount > highestAmount) {
                        highestAmount = amount;
                        highestLetter = letter;
                    }
                }

                var letterIndex: number = letters.indexOf(highestLetter);

                headgearImage = EquipmentData.HeadgearImages["Arena" + arenaIndex]["Common"][letterIndex];
                break;
            default:
                headgearImage = EquipmentData.GetRandomHeadgearImage(rarity, ["Arena" + arenaIndex, "Shared"]);
                break;
        }

        log.debug("arenaindex");

        var equipment: Equipment = {
            Id: "",
            Type: Constants.Sunglasses,
            Rarity: rarity,
            Level: arenaIndex,
            BuffData: {},
            Image: headgearImage,
            LetterData: letterData,
            Version: Constants.EquipmentVersion,
            Locked: false
        };

        log.debug("equipment: " + equipment);
        return equipment;
    }

    private static GetRandomHeadgearImage(rarity:number, catagories: string[]): string {
        var pool = [];
        log.debug("getrandomheadgearimage");

        for (var i = 0; i < catagories.length; i++) {
            var catagory = EquipmentData.HeadgearImages[catagories[i]];
            var poolToAdd = catagory[["Common", "Rare", "Epic", "Legendary"][rarity]];

            for (var j = 0; j < poolToAdd.length; j++) {
                pool[pool.length] = poolToAdd[j];
            }
        }

        var index = Math.floor(Math.random() * pool.length);
        return pool[index];
    }

}


interface Equipment {
    Id: string,
    Type:number,
    Rarity: number,
    Image: string,
    LetterData: EquipmentLetterData,
    BuffData: BuffData,
    Version: number,
    Level: number,
    Locked:Boolean
}

interface HeadgearImages {
    Common: string[],
    Rare: string[],
    Epic: string[],
    Legendary: string[]
}

type BuffData = { [keys: string]: { [keys: string]: string } };
type EquipmentLetterData = { [keys: string]: number };
type HeadgearImageData = { [keys: string]: HeadgearImages };

class AvatarData
{
    public static GetAvatarData(): AvatarDataList
    {
        return {
            alien: {
                Rarity: 0,
                RankData: {
                    0: {
                        LetterData: { a: 1, e: 0, o: 0 },
                        BuffData: { hp: { value: "-5" } }
                    },
                    1: {
                        LetterData: { a: 1, e: 1, o: 0 },
                        BuffData: { hp: { value: "-10" } }
                    },
                    2: {
                        LetterData: { a: 1, e: 1, o: 0 },
                        BuffData: { hp: { value: "-15" } }
                    },
                    3: {
                        LetterData: { a: 1, e: 1, o: 1 },
                        BuffData: { hp: { value: "-20" } }
                    },
                    4: {
                        LetterData: { a: 2, e: 2, o: 1 },
                        BuffData: { hp: { value: "-25" } }
                    },
                    5: {
                        LetterData: { a: 2, e: 2, o: 2 },
                        BuffData: { hp: { value: "-30" } }
                    }
                }
            },
            blue: {
                Rarity: 0,
                RankData: {
                    0: {
                        LetterData: { y: 0 },
                        BuffData: { hp: { value: "0" } }
                    },
                    1: {
                        LetterData: { y: 1 },
                        BuffData: { hp: { value: "5" } }
                    },
                    2: {
                        LetterData: { y: 1 },
                        BuffData: { hp: { value: "10" } }
                    },
                    3: {
                        LetterData: { y: 2 },
                        BuffData: { hp: { value: "15" } }
                    },
                    4: {
                        LetterData: { y: 2 },
                        BuffData: { hp: { value: "20" } }
                    },
                    5: {
                        LetterData: { y: 3 },
                        BuffData: { hp: { value: "25" } }
                    }
                }
            },
            boxer: {

                Rarity: 0,
                RankData: {
                    0: {
                        LetterData: { p: 0, k: 0 },
                        BuffData: { hp: { value: "5" } }
                    },
                    1: {
                        LetterData: { p: 1, k: 0 },
                        BuffData: { hp: { value: "10" } }
                    },
                    2: {
                        LetterData: { p: 1, k: 1 },
                        BuffData: { hp: { value: "15" } }
                    },
                    3: {
                        LetterData: { p: 2, k: 1 },
                        BuffData: { hp: { value: "20" } }
                    },
                    4: {
                        LetterData: { p: 2, k: 2 },
                        BuffData: { hp: { value: "25" } }
                    },
                    5: {
                        LetterData: { p: 3, k: 4 },
                        BuffData: { hp: { value: "35" } }
                    }
                }
            },
            cat: {
                Rarity: 0,
                RankData: {
                    0: {
                        LetterData: { d: -1, c: 1 },
                        BuffData: { hp: { value: "5" } }
                    },
                    1: {
                        LetterData: { d: -2, c: 2 },
                        BuffData: { hp: { value: "10" } }
                    },
                    2: {
                        LetterData: { d: -3, c: 3 },
                        BuffData: { hp: { value: "15" } }
                    },
                    3: {
                        LetterData: { d: -4, c: 4 },
                        BuffData: { hp: { value: "20" } }
                    },
                    4: {
                        LetterData: { d: -5, c: 5 },
                        BuffData: { hp: { value: "25" } }
                    },
                    5: {
                        LetterData: { d: -6, c: 6 },
                        BuffData: { hp: { value: "30" } }
                    }
                }
            },
            clown: {
                Rarity: 0,
                RankData: {
                    0: {
                        LetterData: { a: 0, h: 0 },
                        BuffData: { hp: { value: "5" } }
                    },
                    1: {
                        LetterData: { a: 0, h: 1 },
                        BuffData: { hp: { value: "10" } }
                    },
                    2: {
                        LetterData: { a: 1, h: 1 },
                        BuffData: { hp: { value: "15" } }
                    },
                    3: {
                        LetterData: { a: 1, h: 2 },
                        BuffData: { hp: { value: "20" } }
                    },
                    4: {
                        LetterData: { a: 1, h: 3 },
                        BuffData: { hp: { value: "25" } }
                    },
                    5: {
                        LetterData: { a: 2, h: 4 },
                        BuffData: { hp: { value: "30" } }
                    }
                }
            },
            cow: {
                Rarity: 0,
                RankData: {
                    0: {
                        LetterData: { m: 0 },
                        BuffData: { hp: { value: "10" } }
                    },
                    1: {
                        LetterData: { m: 1 },
                        BuffData: { hp: { value: "15" } }
                    },
                    2: {
                        LetterData: { m: 1 },
                        BuffData: { hp: { value: "25" } }
                    },
                    3: {
                        LetterData: { m: 2 },
                        BuffData: { hp: { value: "35" } }
                    },
                    4: {
                        LetterData: { m: 3 },
                        BuffData: { hp: { value: "50" } }
                    },
                    5: {
                        LetterData: { m: 4 },
                        BuffData: { hp: { value: "70" } }
                    }
                }
            },
            dinosaur: {
                Rarity: 0,
                RankData: {
                    0: {
                        LetterData: { t: 0 },
                        BuffData: { hp: { value: "10" } }
                    },
                    1: {
                        LetterData: { t: 1 },
                        BuffData: { hp: { value: "15" } }
                    },
                    2: {
                        LetterData: { t: 1 },
                        BuffData: { hp: { value: "25" } }
                    },
                    3: {
                        LetterData: { t: 2 },
                        BuffData: { hp: { value: "35" } }
                    },
                    4: {
                        LetterData: { t: 2 },
                        BuffData: { hp: { value: "50" } }
                    },
                    5: {
                        LetterData: { t: 3 },
                        BuffData: { hp: { value: "70" } }
                    }
                }
            },
            dog: {
                Rarity: 0,
                RankData: {
                    0: {
                        LetterData: { d: 1, c: -1 },
                        BuffData: { hp: { value: "5" } }
                    },
                    1: {
                        LetterData: { d: 2, c: -2 },
                        BuffData: { hp: { value: "10" } }
                    },
                    2: {
                        LetterData: { d: 3, c: -3 },
                        BuffData: { hp: { value: "15" } }
                    },
                    3: {
                        LetterData: { d: 4, c: -4 },
                        BuffData: { hp: { value: "20" } }
                    },
                    4: {
                        LetterData: { d: 5, c: -5 },
                        BuffData: { hp: { value: "25" } }
                    },
                    5: {
                        LetterData: { d: 6, c: -6 },
                        BuffData: { hp: { value: "30" } }
                    }
                }
            },
            dragon: {
                Rarity: 0,
                RankData: {
                    0: {
                        LetterData: { f: 0, i: 0, r: 1, e: 0 },
                        BuffData: { hp: { value: "10" } }
                    },
                    1: {
                        LetterData: { f: 1, i: 0, r: 1, e: 0 },
                        BuffData: { hp: { value: "20" } }
                    },
                    2: {
                        LetterData: { f: 1, i: 1, r: 1, e: 1 },
                        BuffData: { hp: { value: "30" } }
                    },
                    3: {
                        LetterData: { f: 2, i: 1, r: 2, e: 1 },
                        BuffData: { hp: { value: "40" } }
                    },
                    4: {
                        LetterData: { f: 2, i: 2, r: 2, e: 2 },
                        BuffData: { hp: { value: "50" } }
                    },
                    5: {
                        LetterData: { f: 3, i: 3, r: 3, e: 3 },
                        BuffData: { hp: { value: "60" } }
                    }
                }
            },
            fairy: {
                Rarity: 0,
                RankData: {
                    0: {
                        LetterData: { l: 1, g: 0, n: 0 },
                        BuffData: { hp: { value: "-5" } }
                    },
                    1: {
                        LetterData: { l: 1, g: 1, n: 0 },
                        BuffData: { hp: { value: "-10" } }
                    },
                    2: {
                        LetterData: { l: 1, g: 2, n: 1 },
                        BuffData: { hp: { value: "-15" } }
                    },
                    3: {
                        LetterData: { l: 2, g: 2, n: 1 },
                        BuffData: { hp: { value: "-25" } }
                    },
                    4: {
                        LetterData: { l: 2, g: 3, n: 1 },
                        BuffData: { hp: { value: "-35" } }
                    },
                    5: {
                        LetterData: { l: 2, g: 4, n: 2 },
                        BuffData: { hp: { value: "-40" } }
                    }
                }
            },
            frank: {
                Rarity: 0,
                RankData: {
                    0: {
                        LetterData: {},
                        BuffData: { hp: { value: "10" } }
                    },
                    1: {
                        LetterData: {},
                        BuffData: { hp: { value: "15" } }
                    },
                    2: {
                        LetterData: {},
                        BuffData: { hp: { value: "25" } }
                    },
                    3: {
                        LetterData: {},
                        BuffData: { hp: { value: "40" } }
                    },
                    4: {
                        LetterData: {},
                        BuffData: { hp: { value: "60" } }
                    },
                    5: {
                        LetterData: {},
                        BuffData: { hp: { value: "90" } }
                    }
                }
            },
            pirate: {
                Rarity: 0,
                RankData: {
                    0: {
                        LetterData: { r: 1 },
                        BuffData: { hp: { value: "0" } }
                    },
                    1: {
                        LetterData: { r: 1 },
                        BuffData: { hp: { value: "10" } }
                    },
                    2: {
                        LetterData: { r: 2 },
                        BuffData: { hp: { value: "20" } }
                    },
                    3: {
                        LetterData: { r: 2 },
                        BuffData: { hp: { value: "30" } }
                    },
                    4: {
                        LetterData: { r: 2 },
                        BuffData: { hp: { value: "50" } }
                    },
                    5: {
                        LetterData: { r: 3 },
                        BuffData: { hp: { value: "50" } }
                    }
                }
            },
            red: {
                Rarity: 0,
                RankData: {
                    0: {
                        LetterData: { x: 0 },
                        BuffData: { hp: { value: "0" } }
                    },
                    1: {
                        LetterData: { x: 1 },
                        BuffData: { hp: { value: "5" } }
                    },
                    2: {
                        LetterData: { x: 1 },
                        BuffData: { hp: { value: "10" } }
                    },
                    3: {
                        LetterData: { x: 2 },
                        BuffData: { hp: { value: "15" } }
                    },
                    4: {
                        LetterData: { x: 3 },
                        BuffData: { hp: { value: "20" } }
                    },
                    5: {
                        LetterData: { x: 4 },
                        BuffData: { hp: { value: "25" } }
                    }
                }
            },
            robber: {
                Rarity: 0,
                RankData: {
                    0: {
                        LetterData: { a: -1, b: 1, d: 1 },
                        BuffData: { hp: { value: "5" } }
                    },
                    1: {
                        LetterData: { a: -1, b: 1, d: 1 },
                        BuffData: { hp: { value: "15" } }
                    },
                    2: {
                        LetterData: { a: -1, b: 2, d: 1 },
                        BuffData: { hp: { value: "15" } }
                    },
                    3: {
                        LetterData: { a: -1, b: 2, d: 1 },
                        BuffData: { hp: { value: "25" } }
                    },
                    4: {
                        LetterData: { a: -1, b: 2, d: 2 },
                        BuffData: { hp: { value: "25" } }
                    },
                    5: {
                        LetterData: { a: -1, b: 3, d: 3 },
                        BuffData: { hp: { value: "35" } }
                    }
                }
            },
            robot: {
                Rarity: 0,
                RankData: {
                    0: {
                        LetterData: { q: 1 },
                        BuffData: { hp: { value: "0" } }
                    },
                    1: {
                        LetterData: { q: 2 },
                        BuffData: { hp: { value: "0" } }
                    },
                    2: {
                        LetterData: { q: 4 },
                        BuffData: { hp: { value: "0" } }
                    },
                    3: {
                        LetterData: { q: 6 },
                        BuffData: { hp: { value: "0" } }
                    },
                    4: {
                        LetterData: { q: 8 },
                        BuffData: { hp: { value: "0" } }
                    },
                    5: {
                        LetterData: { q: 11 },
                        BuffData: { hp: { value: "0" } }
                    }
                }
            },
            superhero: {
                Rarity: 0,
                RankData: {
                    0: {
                        LetterData: { s: 0, u: 0, p: 1 },
                        BuffData: { hp: { value: "10" } }
                    },
                    1: {
                        LetterData: { s: 0, u: 1, p: 1 },
                        BuffData: { hp: { value: "20" } }
                    },
                    2: {
                        LetterData: { s: 1, u: 1, p: 1 },
                        BuffData: { hp: { value: "30" } }
                    },
                    3: {
                        LetterData: { s: 1, u: 1, p: 2 },
                        BuffData: { hp: { value: "30" } }
                    },
                    4: {
                        LetterData: { s: 1, u: 1, p: 3 },
                        BuffData: { hp: { value: "40" } }
                    },
                    5: {
                        LetterData: { s: 1, u: 2, p: 3 },
                        BuffData: { hp: { value: "50" } }
                    }
                }
            },
            teddy: {
                Rarity: 0,
                RankData: {
                    0: {
                        LetterData: { b: 0 },
                        BuffData: { hp: { value: "10" } }
                    },
                    1: {
                        LetterData: { b: 1 },
                        BuffData: { hp: { value: "15" } }
                    },
                    2: {
                        LetterData: { b: 1 },
                        BuffData: { hp: { value: "25" } }
                    },
                    3: {
                        LetterData: { b: 2 },
                        BuffData: { hp: { value: "35" } }
                    },
                    4: {
                        LetterData: { b: 3 },
                        BuffData: { hp: { value: "50" } }
                    },
                    5: {
                        LetterData: { b: 4 },
                        BuffData: { hp: { value: "70" } }
                    }
                }
            },
            wizard: {
                Rarity: 0,
                RankData: {
                    0: {
                        LetterData: { w: 1, i: 0, z: 0 },
                        BuffData: { hp: { value: "0" } }
                    },
                    1: {
                        LetterData: { w: 1, i: 0, z: 1 },
                        BuffData: { hp: { value: "0" } }
                    },
                    2: {
                        LetterData: { w: 1, i: 1, z: 1 },
                        BuffData: { hp: { value: "0" } }
                    },
                    3: {
                        LetterData: { w: 2, i: 1, z: 2 },
                        BuffData: { hp: { value: "0" } }
                    },
                    4: {
                        LetterData: { w: 3, i: 1, z: 3 },
                        BuffData: { hp: { value: "0" } }
                    },
                    5: {
                        LetterData: { w: 4, i: 2, z: 4 },
                        BuffData: { hp: { value: "0" } }
                    }
                }
            }
        }
    }

    public static GetAvatarRankMetaData(): AvatarRankMetaData {
        return {
            0: {
                0: {
                    Xp: 1000,
                    Cost: 50
                },
                1: {
                    Xp: 2000,
                    Cost: 200
                },
                2: {
                    Xp: 5000,
                    Cost: 500
                },
                3: {
                    Xp: 10000,
                    Cost: 1000
                },
                4: {
                    Xp: 20000,
                    Cost: 2000
                },
                5: {
                    Xp: 40000,
                    Cost: 4000
                },
                6: {
                    Xp: 100000,
                    Cost: 10000
                },
                7: {
                    Xp: 200000,
                    Cost: 20000
                },
                8: {
                    Xp: 400000,
                    Cost: 40000
                }
            },
            1: {
                0: {
                    Xp: 1000,
                    Cost: 50
                },
                1: {
                    Xp: 2000,
                    Cost: 200
                },
                2: {
                    Xp: 5000,
                    Cost: 500
                },
                3: {
                    Xp: 10000,
                    Cost: 1000
                },
                4: {
                    Xp: 20000,
                    Cost: 2000
                },
                5: {
                    Xp: 40000,
                    Cost: 4000
                },
                6: {
                    Xp: 100000,
                    Cost: 10000
                },
                7: {
                    Xp: 200000,
                    Cost: 20000
                },
                8: {
                    Xp: 400000,
                    Cost: 40000
                }
            },
            2: {
                0: {
                    Xp: 1000,
                    Cost: 50
                },
                1: {
                    Xp: 2000,
                    Cost: 200
                },
                2: {
                    Xp: 5000,
                    Cost: 500
                },
                3: {
                    Xp: 10000,
                    Cost: 1000
                },
                4: {
                    Xp: 20000,
                    Cost: 2000
                },
                5: {
                    Xp: 40000,
                    Cost: 4000
                },
                6: {
                    Xp: 100000,
                    Cost: 10000
                },
                7: {
                    Xp: 200000,
                    Cost: 20000
                },
                8: {
                    Xp: 400000,
                    Cost: 40000
                }
            },
            3: {
                0: {
                    Xp: 1000,
                    Cost: 50
                },
                1: {
                    Xp: 2000,
                    Cost: 200
                },
                2: {
                    Xp: 5000,
                    Cost: 500
                },
                3: {
                    Xp: 10000,
                    Cost: 1000
                },
                4: {
                    Xp: 20000,
                    Cost: 2000
                },
                5: {
                    Xp: 40000,
                    Cost: 4000
                },
                6: {
                    Xp: 100000,
                    Cost: 10000
                },
                7: {
                    Xp: 200000,
                    Cost: 20000
                },
                8: {
                    Xp: 400000,
                    Cost: 40000
                }
            }
        };
    };

    public static GetPlayerAvatarInfo(): AvatarList  {
        return {
            alien: { IsPurchased: false, Xp: 0, Rank: 0 },
            blue: { IsPurchased: true, Xp: 0, Rank: 0 },
            boxer: { IsPurchased: false, Xp: 0, Rank: 0 },
            cat: { IsPurchased: false, Xp: 0, Rank: 0 },
            clown: { IsPurchased: false, Xp: 0, Rank: 0 },
            cow: { IsPurchased: false, Xp: 0, Rank: 0 },
            dinosaur: { IsPurchased: false, Xp: 0, Rank: 0 },
            dog: { IsPurchased: false, Xp: 0, Rank: 0 },
            dragon: { IsPurchased: false, Xp: 0, Rank: 0 },
            fairy: { IsPurchased: false, Xp: 0, Rank: 0 },
            frank: { IsPurchased: false, Xp: 0, Rank: 0 },
            pirate: { IsPurchased: false, Xp: 0, Rank: 0 },
            red: { IsPurchased: true, Xp: 0, Rank: 0 },
            robber: { IsPurchased: false, Xp: 0, Rank: 0 },
            robot: { IsPurchased: false, Xp: 0, Rank: 0 },
            superhero: { IsPurchased: false, Xp: 0, Rank: 0 },
            teddy: { IsPurchased: false, Xp: 0, Rank: 0 },
            wizard: { IsPurchased: false, Xp: 0, Rank: 0 }
        };
    }

    public static GetRandomAvatar(rarity: number): AvatarId
    {
        var avatarsData = AvatarData.GetAvatarData();
        var avatars = AvatarData.GetPlayerAvatarInfo();
        var pool: AvatarId[] = [];

        for (var id in avatars) {
            var avatar = avatars[id];
            var avatarRarity:number = avatarsData[id].Rarity;
            if (avatarRarity == rarity)
                pool.push({ Id: id, Avatar: avatar });
        }

        return pool[Math.floor(Math.random() * pool.length)];
    }

    public static GainXp(id: string, xp: number) {
        var result = { Avatars: null };

        log.debug("gain xp: " + id + ", " + xp);
        var internalDataResult = server.GetUserInternalData({
            PlayFabId: currentPlayerId,
            Keys: [Constants.Avatars]
        });

        result.Avatars = JSON.parse(internalDataResult.Data[Constants.Avatars].Value);
        result.Avatars[id].Xp += xp;

        log.debug("avatar xp: " + result.Avatars[id].Xp);

        var returnData: { [keys: string]: string } = {};
        returnData[Constants.Avatars] = JSON.stringify(result.Avatars);
        internalDataResult = server.UpdateUserInternalData({
            PlayFabId: currentPlayerId,
            Data: returnData
        });
        log.debug("complete");

        return result;
    }

    public static IncreaseAvatarRank(id: string)
    {
        var result = { Coins: -1, Avatars: null };

        log.debug("get avatar rank");

        var avatarRanks = AvatarData.GetAvatarRankMetaData();

        log.debug("get avatar data");
        var avatarsData = AvatarData.GetAvatarData();



        var internalDataResult = server.GetUserInternalData({
            PlayFabId: currentPlayerId,
            Keys: [Constants.Avatars]
        });
        log.debug("get avatars");
        var avatars = JSON.parse(internalDataResult.Data[Constants.Avatars].Value);


        log.debug("get avatar");
        var avatar:Avatar = avatars[id];

        var rankData: AvatarRank = avatarRanks[avatarsData[id].Rarity][avatar.Rank];

        log.debug("rank data");
        var currencyResult = server.SubtractUserVirtualCurrency({
            PlayFabId: currentPlayerId,
            VirtualCurrency: Constants.Coins,
            Amount: rankData.Cost
        });

        log.debug("purchased");
        avatar.Xp -= rankData.Xp;
        avatar.Rank++;
        log.debug("increase rank");
        var data: { [keys: string]: string } = {};
        data[Constants.Avatars] = JSON.stringify(avatars);

        log.debug("json");
        // send the modified values back to the player's internal data
        internalDataResult = server.UpdateUserInternalData({
            PlayFabId: currentPlayerId,
            Data: data
        });

        log.debug("complete");
        result.Coins = currencyResult.Balance;
        result.Avatars = avatars;
        return result;
    }
}

type AvatarList = { [keys: string]: Avatar }

interface Avatar {
    IsPurchased: boolean,
    Xp: number,
    Rank: number
}

type AvatarDataList = { [keys: string]: AvatarData }

interface AvatarData {
    Rarity: number,
    RankData: {[keys: number]: AvatarRankData}
}


type AvatarRanksData = { [keys: string]: AvatarRanksData }
type AvatarRankData = { LetterData: AvatarLetterData, BuffData: BuffData }
type AvatarLetterData = { [keys: string]: number };

interface AvatarRank {
    Xp: number,
    Cost: number
}

type AvatarId = { Id: string, Avatar: Avatar }
type AvatarRankMetaData = {
    [keys: number]: {
        [keys: number]: AvatarRank
    }
}